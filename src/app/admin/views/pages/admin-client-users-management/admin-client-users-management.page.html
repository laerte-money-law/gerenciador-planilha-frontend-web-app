<!-- TODO: Colocar qual é a empresa -->
<div class="mb-5">
    <h1 class="page-heading d-flex flex-column justify-content-center my-0 text-gray-700">
        {{ client?.companyName }}
        <span class="text-muted fs-4 pt-2"> {{ client?.cnpj && formatDocument(client.cnpj, "CNPJ") }}</span>
    </h1>
</div>

<section class="section mb-5 mb-xl-10">
    <form class="form" (ngSubmit)="onSubmit()">
        <div class="row">
            <div class="col-12">
                <div class="card card-flush mb-5 mb-xl-10">
                    <div class="card-header">
                        <h2 class="card-title">Dados do usuário</h2>
                    </div>
                    <div class="card-body pt-0">
                        <div class="row">
                            <div class="col-md-6 col-12 mb-6">
                                <app-input-text
                                    #inputName
                                    label="Nome"
                                    placeholder="Ex: Bruce Wayne"
                                    [required]="true"
                                    [modifier]="nameInputTextModifier"
                                    [readOnly]="!isFormInEditableState()"
                                ></app-input-text>
                            </div>
                            <div class="col-md-6 col-12 mb-6">
                                <app-input-text
                                    #inputPhone
                                    label="Telefone"
                                    type="tel"
                                    placeholder="Ex: (11) 123 456 789"
                                    [mask]="PHONE_MASK"
                                    [required]="true"
                                    [readOnly]="!isFormInEditableState()"
                                ></app-input-text>
                            </div>
                            <div class="col-md-6 col-12 mb-6">
                                <app-input-text
                                    #inputEmail
                                    label="Email"
                                    placeholder="Ex: fulano@exemplo.com"
                                    [required]="true"
                                    [modifier]="lowerCaseInputTextModifier"
                                    [validators]="[emailInputTextValidator]"
                                    [readOnly]="!isFormInEditableState()"
                                ></app-input-text>
                            </div>
                            <div class="col-md-6 col-12 mb-6">
                                <label class="form-label">Senha temporária</label>
                                <div *ngIf="isPasswordInEditMode">
                                    <div class="input-group">
                                        <input
                                            name="password"
                                            type="text"
                                            class="form-control"
                                            placeholder="Ex: P@ssw0rd"
                                            [(ngModel)]="form.fields.password.value"
                                            (keyup)="isFormInErrorState() && form.fields.password.validate()"
                                            [ngClass]="{ 'is-invalid': !form.fields.password.isValid() && isFormInErrorState()}"
                                        />
                                        <span class="input-group-text" role="button" (click)="onGeneratePassword()">Gerar senha</span>
                                        <div class="invalid-feedback" *ngIf="!form.fields.password.isValid() && isFormInErrorState()">
                                            <div *ngIf="form.fields.password.failedValidations.required">A senha é obrigatória.</div>
                                        </div>
                                    </div>
                                    <div class="form-text">
                                        Ao realizar o login com esta senha, o usuário será forçado a definir uma nova senha.
                                    </div>
                                </div>
                                <div *ngIf="!isPasswordInEditMode">
                                    <div class="input-group">
                                        <input name="password" type="password" class="form-control" value="12caracteres" readonly />
                                        <span class="input-group-text" role="button" (click)="onChangePassword()">Alterar senha</span>
                                    </div>
                                    <div class="form-text">
                                        Para alterar a senha de login do usuário, clique no botão "Alterar senha". Caso a senha seja
                                        alterada, ao realizar o login, o usuário será obrigado a definir uma nova senha.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-12">
                <div class="d-flex justify-content-end">
                    <button
                        type="button"
                        class="btn btn-light btn-active-light-primary me-5"
                        [disabled]="!isFormInEditableState()"
                        [routerLink]="[URLS.PATHS.ADMIN.CLIENT.ROOT()]"
                    >
                        Cancelar
                    </button>
                    <app-button
                        classes="btn-primary w-100"
                        text="Salvar"
                        [isLoading]="isFormInLoadingState()"
                        [loadingText]="'Processando...'"
                        [isSubmitted]="isFormInSuccessState()"
                        [submittedText]="'Concluído!'"
                    ></app-button>
                </div>
            </div>
        </div>
    </form>
</section>

<!-- Usuários cadastrados -->
<div class="row">
    <div class="col-12">
        <div class="card card-flush mb-5 mb-xl-10">
            <div class="card-header">
                <h2 class="card-title">Usuários cadastrados</h2>
            </div>
            <div class="card-body py-4" *ngIf="allRecords?.length > 0">
                <div class="dt-container dt-bootstrap5 dt-empty-footer">
                    <!-- Lista de registros -->
                    <div id="" class="table-responsive">
                        <table class="table table-striped align-middle table-row-dashed fs-7 gy-5 dataTable" style="width: 100%">
                            <thead>
                                <tr class="text-start text-muted fw-bold fs-7 text-uppercase gs-0" role="row">
                                    <th class="min-w-125px" data-dt-column="1" rowspan="1" colspan="1" tabindex="0">
                                        <span class="dt-column-title" role="button">Nome</span>
                                    </th>
                                    <th class="min-w-125px" data-dt-column="2" rowspan="1" colspan="1" tabindex="0">
                                        <span class="dt-column-title" role="button">Email</span>
                                    </th>
                                    <th class="min-w-125px" data-dt-column="3" rowspan="1" colspan="1" tabindex="0">
                                        <span class="dt-column-title" role="button">Telefone</span>
                                    </th>
                                    <th class="min-w-125px" data-dt-column="4" rowspan="1" colspan="1" tabindex="0">
                                        <span class="dt-column-title" role="button">Status</span>
                                    </th>
                                    <th class="min-w-125px" data-dt-column="5" rowspan="1" colspan="1" tabindex="0">
                                        <span class="dt-column-title" role="button">Data/hora do cadastro</span>
                                    </th>
                                    <th class="text-center min-w-100px dt-orderable-none" data-dt-column="6" rowspan="1" colspan="1">
                                        <span class="dt-column-title">Ações</span>
                                    </th>
                                </tr>
                            </thead>
                            <tbody class="text-gray-600 fw-semibold">
                                <tr *ngFor="let clientUser of pagination?.getPage()">
                                    <td>
                                        <a class="text-gray-600 text-hover-primary mb-1 text-gray-600">{{clientUser.name}}</a>
                                    </td>
                                    <td>
                                        <span *ngIf="clientUser.email" class="text-nowrap">
                                            {{clientUser.email}}
                                            <a
                                                href="https://mail.google.com/mail/?view=cm&to={{clientUser.email}}&su=ASSUNTO&body=CORPO DO E-MAIL"
                                                class="ms-3"
                                                target="_blank"
                                            >
                                                <i class="fa-solid fa-envelope text-primary"></i>
                                            </a>
                                        </span>
                                    </td>
                                    <td>
                                        <span *ngIf="clientUser.phone" class="text-nowrap">
                                            {{formatPhone(clientUser.phone)}}
                                            <a href="tel:{{clientUser.phone}}" class="ms-3" target="_blank">
                                                <i class="fa-solid fa-phone text-primary"></i>
                                            </a>
                                            <a href="https://wa.me/{{clientUser.phone.removeNonDigits()}}" class="ms-3" target="_blank">
                                                <i class="fa-brands fa-whatsapp fa-lg text-primary"></i>
                                            </a>
                                        </span>
                                    </td>
                                    <td>
                                        <app-badge-activation-status [status]="clientUser.status"></app-badge-activation-status>
                                    </td>
                                    <td>{{formatDateTime(clientUser.createdAt)}}</td>
                                    <td class="text-end">
                                        <span ngbDropdown container="body">
                                            <a
                                                role="button"
                                                class="btn btn-light btn-active-light-primary btn-flex btn-center btn-sm text-gray-600"
                                                ngbDropdownToggle
                                            >
                                                Ações
                                                <i class="fa-solid fa-angle-down fs-6 ms-2 text-gray-600"></i>
                                            </a>
                                            <div
                                                class="menu menu-sub menu-sub-dropdown menu-column menu-rounded menu-gray-600 menu-state-bg-light-primary fw-semibold fs-7 w-125px py-4"
                                                ngbDropdownMenu
                                            >
                                                <div class="menu-item px-3">
                                                    <a role="button" class="menu-link px-3" (click)="onEdit(clientUser.code)"> Editar </a>
                                                </div>

                                                <div class="menu-item px-3">
                                                    <a role="button" class="menu-link px-3" (click)="onUpdateStatus(clientUser.code)">
                                                        Ativar/Inativar
                                                    </a>
                                                </div>

                                                <div class="menu-item px-3">
                                                    <a role="button" class="menu-link px-3" (click)="onDeleteClientUser(clientUser.code)">
                                                        Excluir
                                                    </a>
                                                </div>
                                            </div>
                                        </span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Paginação -->
                    <div id="" class="row" *ngIf="pagination?.getTotalPages() > 1">
                        <div
                            id=""
                            class="col-sm-12 col-md-5 d-flex align-items-center justify-content-center justify-content-md-start dt-toolbar"
                        ></div>
                        <div id="" class="col-sm-12 col-md-7 d-flex align-items-center justify-content-center justify-content-md-end">
                            <div class="dt-paging paging_simple_numbers">
                                <nav>
                                    <ul class="pagination">
                                        <li class="dt-paging-button page-item" [class]="pagination?.isFirstPage() ? 'disabled' : ''">
                                            <button
                                                class="page-link previous"
                                                role="link"
                                                type="button"
                                                (click)="pagination?.goToPreviousPage()"
                                            >
                                                <i class="previous"></i>
                                            </button>
                                        </li>
                                        <li
                                            class="dt-paging-button page-item"
                                            *ngFor="let pageNumber of pagination?.getTotalPagesAsArray()"
                                            [ngClass]="{ active: pageNumber === pagination?.getCurrentPage() }"
                                        >
                                            <button class="page-link" role="link" type="button" (click)="pagination?.goToPage(pageNumber)">
                                                {{pageNumber}}
                                            </button>
                                        </li>
                                        <li class="dt-paging-button page-item" [class]="pagination?.isLastPage() ? 'disabled' : ''">
                                            <button class="page-link next" role="link" type="button" (click)="pagination?.goToNextPage()">
                                                <i class="next"></i>
                                            </button>
                                        </li>
                                    </ul>
                                </nav>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Empty state -->
            <div class="card-body" *ngIf="allRecords?.length === 0">
                <div class="d-flex flex-column justify-content-center align-items-center pb-10">
                    <img class="img-fluid" style="max-width: 250px" src="assets/images/storyset/Forms-rafiki.png" />
                    <div class="text-gray-400 fs-4 fw-bold mb-4 text-center">
                        <p class="text-muted">Você não possui nenhum usuário cadastrado.</p>
                        <p class="text-muted">Preencha o formulário acima para cadastrar seu primeiro usuário para este cliente.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal: Excluir -->
<swal
    #deleteSwal
    title="Tem certeza que deseja excluir o usuário {{selectClientUser?.name}}?"
    text="Essa operação não poderá ser desfeita."
    icon="warning"
    confirmButtonText="Excluir"
    cancelButtonText="Cancelar"
    [showCancelButton]="true"
    [customClass]="{ confirmButton: 'btn fw-bold btn-danger', cancelButton: ' fw-bold btn btn-active-light-btn-secondary' }"
    (confirm)="onDeleteConfirmation()"
>
</swal>

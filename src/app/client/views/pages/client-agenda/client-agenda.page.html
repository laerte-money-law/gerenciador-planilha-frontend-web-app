<div class="card">
  <div class="d-flex flex-column flex-md-row card-body py-4">
    <!-- Lateral esquerda: mini calendário + filtros -->
    <div>
      <!-- Mini calendar -->
      <div class="col-md-2 mt-20 p-2 flex-shrink-1 bd-highlight py-6 flex-fill bd-highlight">
        <ngb-datepicker
          #miniCalendar
          [(ngModel)]="selectedDate"
          (ngModelChange)="onDaySelect($event)"
          (navigate)="onMiniNavigate($event)">
        </ngb-datepicker>
      </div>

      <div class="mb-4">
        <span>Filtros </span>
        <i class="fa-solid fa-filter"></i>
      </div>

      <div class="form-check mb-6">
        <input
          class="form-check-input"
          type="checkbox"
          id="chkVencidas"
          [(ngModel)]="showOverDue"
          (change)="onCheckboxChange()"
        />
        <label class="form-check-label" for="chkVencidas">
          Apólices vencidas
        </label>
      </div>

      <div class="form-check mb-6">
        <input
          class="form-check-input"
          type="checkbox"
          id="chkAVencer"
          [(ngModel)]="showToExpire"
          (change)="onCheckboxChange()"
        />
        <label class="form-check-label" for="chkAVencer">
          Apólices a vencer
        </label>
      </div>

      <div class="mb-6">
        <span>Total de apólices: {{ totalItems }}</span>
      </div>
    </div>

    <!-- Área principal -->
    <div class="col-md-9 flex-grow-1 card-body py-4 p-2 flex-fill bd-highlight">
      <full-calendar
        #fullCalendar
        [options]="calendarOptions"
        class="card-body py-4">
      </full-calendar>

      <!-- Lista -->
      <div *ngIf="selectedPolicies?.length" class="mt-4">
        <h6 class="title-policy-list mb-3">Lista de Apólices:</h6>

        <div class="table-responsive">
          <table class="table table-striped align-middle table-row-dashed fs-7 gy-5 dataTable">
            <thead>
              <tr class="text-start text-gray-400 fw-bold fs-7 text-uppercase gs-0">
                <th>Título</th>
                <th>Fim da vigência</th>
                <th>Status</th>
                <th>Dias restantes</th>
                <th class="text-center">Ações</th>
              </tr>
            </thead>
            <tbody class="text-gray-600 fw-semibold">
              <tr *ngFor="let item of selectedPolicies">
                <td><a class="text-gray-600 text-hover-primary mb-1">{{ item.title }}</a></td>
                <td>{{ $any(item).date | date:'dd/MM/yyyy' }}</td>
                <td>
                  <span class="badge text-bg-{{item.colorClass}}">
                    {{ item.statusName }}
                  </span>
                </td>
                <td class="text-center">
                  <span class="text-center text-gray-600 text-hover-primary mb-1">
                    {{ item.daysRemaining }}
                  </span>
                </td>
                <td class="text-end">
                  <span ngbDropdown container="body">
                    <a
                      role="button"
                      class="btn btn-light btn-active-light-primary btn-flex btn-center btn-sm"
                      ngbDropdownToggle
                    >
                      Ações
                      <i class="fa-solid fa-angle-down fs-6 ms-2"></i>
                    </a>
                    <div
                      class="menu menu-sub menu-sub-dropdown menu-column menu-rounded menu-gray-600 menu-state-bg-light-primary fw-semibold fs-7 w-125px py-4"
                      ngbDropdownMenu
                    >
                      <div class="menu-item px-3">
                        <a
                          class="menu-link px-3"
                          role="button"
                          (click)="onShowPolicyDetailsFromEvent(item)"
                        >
                          Detalhes da apólice
                        </a>
                      </div>
                    </div>
                  </span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Paginação -->
        <div class="row" *ngIf="pagination?.getTotalPages() > 1">
          <div class="col-sm-12 col-md-5 d-flex align-items-center justify-content-center justify-content-md-start dt-toolbar"></div>
          <div class="col-sm-12 col-md-7 d-flex align-items-center justify-content-center justify-content-md-end">
            <div class="dt-paging paging_simple_numbers">
              <nav>
                <ul class="pagination">
                  <li class="dt-paging-button page-item" [class.disabled]="pagination?.isFirstPage()">
                    <button class="page-link previous" role="link" type="button" (click)="pagination?.goToPreviousPage()">
                      <i class="previous"></i>
                    </button>
                  </li>

                  <li
                    class="dt-paging-button page-item"
                    *ngFor="let pageNumber of pagination?.getTotalPagesAsArray()"
                    [ngClass]="{ active: pageNumber === pagination?.getCurrentPage() }"
                  >
                    <button class="page-link" role="link" type="button" (click)="pagination?.goToPage(pageNumber)">
                      {{ pageNumber }}
                    </button>
                  </li>

                  <li class="dt-paging-button page-item" [class.disabled]="pagination?.isLastPage()">
                    <button class="page-link next" role="link" type="button" (click)="pagination?.goToNextPage()">
                      <i class="next"></i>
                    </button>
                  </li>
                </ul>
              </nav>
            </div>
          </div>
        </div>


      <!-- Empty -->
      <div *ngIf="!selectedPolicies?.length" class="mt-4 text-muted">
        Nenhuma apólice para a data/filtro selecionados.
      </div>
    </div>
  </div>
</div>

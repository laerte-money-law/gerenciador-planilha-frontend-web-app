<div class="card card-flush mb-5 mb-xl-10">
    <div class="card-header">
        <h2 class="card-title">Segurado</h2>
    </div>
    <div class="card-body pt-0">
        <div class="row">
            <div class="col-lg-3 col-md-4 col-sm-6 col-12 mb-6">
                <app-input-readonly label="Nome do segurado" [value]="quotationDetails?.name"></app-input-readonly>
            </div>
            <div class="col-lg-3 col-md-4 col-sm-6 col-12 mb-6">
                <app-input-readonly label="Documento do segurado" [value]="formatDocument(quotationDetails?.document)"></app-input-readonly>
            </div>
            <div class="col-lg-3 col-md-4 col-sm-6 col-12 mb-6">
                <app-input-readonly label="Telefone do segurado" [value]="formatPhone(quotationDetails?.phone)"></app-input-readonly>
            </div>
            <div class="col-lg-3 col-md-4 col-sm-6 col-12 mb-6">
                <app-input-readonly label="Email do segurado" [value]="quotationDetails?.email"></app-input-readonly>
            </div>

            <div class="col-lg-3 col-md-4 col-sm-6 col-12 mb-6">
                <app-input-readonly label="Nº do processo" [value]="quotationDetails?.caseNumber"></app-input-readonly>
            </div>
            <div class="col-lg-3 col-md-4 col-sm-6 col-12 mb-6">
                <app-input-readonly label="Tribunal/Vara" [value]="quotationDetails?.court"></app-input-readonly>
            </div>
            <div class="col-lg-6 col-12 mb-6">
                <app-input-readonly label="Endereço do segurado" [value]="getAddressFormatted()"></app-input-readonly>
            </div>
        </div>
    </div>
</div>

<div class="card card-flush mb-5 mb-xl-10">
    <div class="card-header">
        <h2 class="card-title">Seguradoras</h2>
    </div>
    <div class="card-body pt-0">
        <!-- Listagem de seguradoras -->
        <div id="" class="table-responsive">
            <table class="table table-striped align-middle table-row-dashed fs-6 gy-5 dataTable" style="width: 100%">
                <thead>
                    <tr class="text-start text-muted fw-bold fs-7 text-uppercase gs-0" role="row">
                        <th class="min-w-125px">
                            <span role="button">Seguradora</span>
                        </th>
                        <th class="min-w-125px">
                            <span role="button">Status</span>
                        </th>
                        <th class="min-w-125px">
                            <span role="button">Proposta</span>
                        </th>
                        <th class="min-w-125px">
                            <span role="button">Valor do prêmio</span>
                        </th>
                        <th class="min-w-125px">
                            <span role="button">Vencimento Boleto</span>
                        </th>
                        <th class="text-center min-w-125px">
                            <span role="button">Ações</span>
                        </th>
                    </tr>
                </thead>
                <tbody class="text-gray-600 fw-semibold">
                    <!-- TODO: melhorar isso aqui -->
                    <tr *ngFor="let quotation of quotationDetails?.quotationInsuranceCompanies">
                        <td>
                            <span class="text-gray-600 text-hover-primary mb-1">{{ quotation.insuranceCompanyName }}</span>
                        </td>
                        <td>
                            <app-badge-quotation-status [status]="quotation.status"></app-badge-quotation-status>
                        </td>
                        <td>
                            <a
                                target="_blank"
                                rel="noopener noreferrer"
                                role="button"
                                class="text-hover-primary text-decoration-underline"
                                (click)="openQuotationDocument(quotation.insuranceCompanyRegistrationCode)"
                                *ngIf="isQuotationApproved(quotation)"
                            >
                                <span class="me-2"> Link da proposta </span>
                                <i class="fa-solid fa-arrow-up-right-from-square text-primary"></i>
                            </a>
                            <span *ngIf="!isQuotationApproved(quotation)">-</span>
                        </td>
                        <td align="center">
                            <span class="text-gray-600 text-hover-primary mb-1">{{ formatCurrency(quotation.premiumValue) }}</span>
                        </td>
                        <td align="center">
                            <span class="text-gray-600 text-hover-primary mb-1">{{ formatDate(quotation.bankSlipDueDate) }}</span>
                        </td>
                        <td class="text-center">
                            <span ngbDropdown container="body">
                                <button
                                    type="button"
                                    class="btn btn-light btn-active-light-primary btn-flex btn-center btn-sm"
                                    ngbDropdownToggle
                                    *ngIf="isQuotationApproved(quotation)"
                                >
                                    Ações
                                    <i class="fa-solid fa-angle-down fs-6 ms-2"></i>
                                </button>
                                <div
                                    class="menu menu-sub menu-sub-dropdown menu-column menu-rounded menu-gray-600 menu-state-bg-light-primary fw-semibold fs-7 w-125px py-4"
                                    ngbDropdownMenu
                                >
                                    <div class="menu-item px-3">
                                        <app-save-modal-button
                                            (opened)="onOpenUpdatePremiumModal(quotation.code)"
                                            (saved)="onUpdatePremium()"
                                            [formComponent]="updatePremiumFormComponent"
                                            buttonText="Atualizar Prêmio"
                                        ></app-save-modal-button>
                                    </div>
                                    <div class="menu-item px-3">
                                        <a
                                            class="bg-primary menu-link px-3 text-white"
                                            (click)="acceptProposal(quotation.insuranceCompanyRegistrationCode)"
                                            *ngIf="isQuotationApproved(quotation)"
                                        >
                                            Aceitar & Emitir
                                        </a>
                                    </div>
                                </div>
                            </span>

                            <span *ngIf="!isQuotationApproved(quotation)">-</span>
                        </td>
                        <!-- TODO: se a cotação estiver pendente, mostrar o botão de solicitar novamente a cotação -->
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="card p-6">
    <div class="d-flex justify-content-between mb-4">
        <div class="mb-5">
            <h1 class="page-heading d-flex flex-column justify-content-center my-0 text-gray-700" *ngIf="client">
                {{ client?.companyName }}
                <span class="text-muted fs-4 pt-2"> {{ client?.cnpj && formatDocument(client.cnpj, "CNPJ") }}</span>
            </h1>
            <h4 class="page-heading text-gray-700" *ngIf="!client">Selecione abaixo em quais seguradoras deseja solicitar cotação</h4>
        </div>

        <div class="d-flex justify-content-end">
            <div class="w-100 w-250px me-4">
                <select class="form-select form-select-solid">
                    <option>Selecione um status</option>
                    <option value="all">Aprovado</option>
                    <option value="published">Em análise</option>
                    <option value="scheduled">Negado</option>
                </select>
            </div>

            <button
                class="btn btn-primary text-nowrap"
                (click)="onRequestInsuranceProposal()"
                *ngIf="showQuotationButton"
                style="height: fit-content"
            >
                <i class="fa-solid fa-paper-plane fs-2 me-2"></i>Solicitar cotação
            </button>
        </div>
    </div>

    <app-select-company *ngIf="!isAdmin" [clientCode]="clientCode" [client]="client" (subsidiarySelected)="handleSubsidiaryChange($event)">
    </app-select-company>

    <!-- Listagem -->
    <div id="" class="table-responsive">
        <table class="table table-striped align-middle table-row-dashed fs-6 gy-5 dataTable" style="width: 100%">
            <thead>
                <tr class="text-start text-muted fw-bold fs-7 text-uppercase gs-0" role="row">
                    <th class=""></th>
                    <th class="min-w-125px">
                        <span role="button">Seguradora</span>
                    </th>
                    <th class="min-w-125px">
                        <span role="button">Valor limite</span>
                    </th>
                    <th class="min-w-125px">
                        <span role="button">Taxa</span>
                    </th>
                    <th class="min-w-125px">
                        <span role="button">Sincronizado em</span>
                    </th>
                    <th class="min-w-125px">
                        <span role="button">Valido até</span>
                    </th>
                    <th class="min-w-125px">
                        <span role="button">Status</span>
                    </th>
                    <th class="min-w-125px">
                        <span role="button">Obs</span>
                    </th>
                    <th class="min-w-125px">
                        <span role="button">Ações</span>
                    </th>
                </tr>
            </thead>
            <tbody class="text-gray-600 fw-semibold">
                <tr *ngFor="let registration of clientInsuranceCompanyRegistrations">
                    <td>
                        <!-- TODO: só exibir o checkbox p/ seguradoras com status APPROVED -->
                        <div
                            class="form-check form-switch"
                            *ngIf="showSelectionCheckbox(registration.insuranceCompanyRegistrationCode) && showQuotationButton"
                        >
                            <input
                                class="form-check-input"
                                type="checkbox"
                                role="switch"
                                id="flexSwitchCheckDefault"
                                (change)="onSelectInsuranceCompany(registration.insuranceCompanyRegistrationCode)"
                            />
                            <label class="form-check-label" for="flexSwitchCheckDefault"></label>
                        </div>
                    </td>
                    <td>{{ registration.insuranceCompanyName }}</td>
                    <td>
                        <span
                            *ngIf="
                                registration.statusInInsuranceCompany === STATUS_IN_INSURANCE_COMPANY.APPROVED && !registration.creditLimit
                            "
                            ><app-label-not-informed></app-label-not-informed
                        ></span>
                        <span
                            *ngIf="
                                registration.statusInInsuranceCompany !== STATUS_IN_INSURANCE_COMPANY.APPROVED || registration.creditLimit
                            "
                        >
                            {{ formatCurrency(registration.creditLimit) }}
                        </span>
                    </td>
                    <td>
                        <span
                            *ngIf="
                                registration.statusInInsuranceCompany === STATUS_IN_INSURANCE_COMPANY.APPROVED &&
                                !registration.annualInterest
                            "
                            ><app-label-not-informed></app-label-not-informed
                        ></span>
                        <span
                            *ngIf="
                                registration.statusInInsuranceCompany !== STATUS_IN_INSURANCE_COMPANY.APPROVED ||
                                registration.annualInterest
                            "
                        >
                            {{ formatPercentage(registration.annualInterest) }}
                        </span>
                    </td>
                    <td>{{ formatDateTime(registration.synchronizedAt) }}</td>
                    <td>{{ formatDateTime(registration.expiresAt) }}</td>
                    <td>
                        <app-badge-insurance-company-registration-status
                            [insuranceCompanyRegistrationStatus]="registration.statusInInsuranceCompany"
                        ></app-badge-insurance-company-registration-status>
                    </td>
                    <td>
                        <span>{{ registration.notes }}</span>
                    </td>
                    <td>
                        <span ngbDropdown container="body">
                            <a
                                role="button"
                                class="text-gray-600 btn btn-light btn-active-light-primary btn-flex btn-center btn-sm"
                                ngbDropdownToggle
                            >
                                Ações
                                <i class="text-gray-600 fa-solid fa-angle-down fs-6 ms-2"></i>
                            </a>
                            <div
                                class="menu menu-sub menu-sub-dropdown menu-column menu-rounded menu-gray-600 menu-state-bg-light-primary fw-semibold fs-7 w-125px py-4"
                                ngbDropdownMenu
                            >
                                <div class="menu-item px-3">
                                    <a
                                        role="button"
                                        class="menu-link px-3 text-nowrap"
                                        (click)="onUpdateClientRegistration(registration.insuranceCompanyRegistrationCode)"
                                    >
                                        Atualizar cadastro
                                    </a>
                                </div>
                            </div>
                        </span>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- TODO: Empty state -->
